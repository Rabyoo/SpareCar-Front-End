<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      style="width: 100px; height: 100px"
      rel="shortcut icon"
      href="./public/favicon.jpg"
      type="image/png" />
    <title>SpareCar</title>
    <meta
      name="description"
      content="Your trusted source for quality car spare parts and accessories. Fast shipping, competitive prices, and expert support." />
    <meta name="author" content="SpareCar" />

    <meta
      property="og:title"
      content="SpareCar - Quality Car Parts & Accessories" />
    <meta
      property="og:description"
      content="Your trusted source for quality car spare parts and accessories. Fast shipping, competitive prices, and expert support." />
    <meta property="og:type" content="website" />
    <script>
      // حل شامل لأخطاء إضافات المتصفح
      (function () {
        // 1. منع أخطاء jQuery من الإضافات
        if (typeof window.$ === "undefined") {
          window.$ = () => ({});
          window.jQuery = window.$;
        }

        // 2. منع خطأ 'indexOf' على null
        const originalIndexOf = String.prototype.indexOf;
        String.prototype.indexOf = function (searchValue, fromIndex) {
          if (this === null || this === undefined) {
            console.warn("Extension: Prevented indexOf on null/undefined");
            return -1;
          }
          return originalIndexOf.call(this, searchValue, fromIndex);
        };

        // 3. منع أخطاء الإضافات من التأثير على التطبيق
        const originalErrorHandler = window.onerror;
        window.onerror = function (message, source, lineno, colno, error) {
          // تجاهل أخطاء الإضافات
          if (source && source.includes("chrome-extension://")) {
            console.warn("Extension error suppressed:", message);
            return true; // منع انتشار الخطأ
          }
          if (source && source.includes("contentScript.js")) {
            console.warn("Content script error suppressed:", message);
            return true;
          }
          // استدعاء الـ handler الأصلي للأخطاء الأخرى
          if (originalErrorHandler) {
            return originalErrorHandler(message, source, lineno, colno, error);
          }
          return false;
        };

        // 4. منع unhandled promise rejections من الإضافات
        window.addEventListener("unhandledrejection", function (event) {
          if (
            event.reason &&
            (event.reason.message?.includes("indexOf") ||
              event.reason.message?.includes("chrome-extension") ||
              event.reason.stack?.includes("contentScript.js"))
          ) {
            console.warn(
              "Extension promise rejection suppressed:",
              event.reason,
            );
            event.preventDefault();
          }
        });

      })();
    </script>
    <script>
      // IMMEDIATE FIX - Run before anything else
      (function () {
        "use strict";

        // Save originals
        const _indexOf = String.prototype.indexOf;
        const _find = Array.prototype.find;
        const _error = console.error;
        const _warn = console.warn;

        // Fix String.indexOf
        String.prototype.indexOf = function (search, from) {
          if (this == null) return -1;
          return _indexOf.call(this, search, from);
        };

        // Fix Array.find
        Array.prototype.find = function (callback, thisArg) {
          if (this == null) return undefined;
          return _find.call(this, callback, thisArg);
        };

        // Filter console errors
        console.error = function () {
          const msg = arguments[0]?.toString() || "";
          if (
            msg.includes("chrome-extension://") ||
            msg.includes("contentScript.js") ||
            msg.includes("jQuery.Deferred") ||
            msg.includes("indexOf")
          ) {
            console.warn(
              "[Extension] Error suppressed:",
              msg.substring(0, 100),
            );
            return;
          }
          _error.apply(console, arguments);
        };

        console.warn = function () {
          const msg = arguments[0]?.toString() || "";
          if (
            msg.includes("chrome-extension://") ||
            msg.includes("contentScript.js")
          ) {
            return; // Silent drop
          }
          _warn.apply(console, arguments);
        };

        // Mock jQuery if missing
        if (typeof window !== "undefined") {
          if (!window.$) {
            window.$ = function () {
              return {
                ready: function (fn) {
                  if (fn) fn();
                  return this;
                },
                on: function () {
                  return this;
                },
                off: function () {
                  return this;
                },
                find: function () {
                  return $();
                },
                each: function () {
                  return this;
                },
              };
            };
            window.jQuery = window.$;
          }
        }

        // Catch unhandled errors
        window.addEventListener(
          "error",
          function (e) {
            if (e.filename && e.filename.includes("chrome-extension://")) {
              e.preventDefault();
              e.stopPropagation();
              return false;
            }
          },
          true,
        );

        // Catch unhandled promise rejections
        window.addEventListener("unhandledrejection", function (e) {
          const reason = e.reason?.message || e.reason?.toString() || "";
          if (
            reason.includes("indexOf") ||
            reason.includes("chrome-extension") ||
            reason.includes("contentScript")
          ) {
            e.preventDefault();
            console.warn("[Extension] Promise rejection suppressed");
          }
        });

      })();
    </script>

    <!-- Google Translate -->
    <script type="text/javascript">
      function googleTranslateElementInit() {
        new google.translate.TranslateElement(
          {
            pageLanguage: "en", // لغة الموقع الأساسية
            includedLanguages: "ar,en", // اللغات اللي عايزها تظهر
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false,
          },
          "google_translate_element",
        );
      }
    </script>
    <script
      type="text/javascript"
      src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
